<link rel="stylesheet" href="RegistroPersone.css">
<html>
<head>
    <script>

        // Variabile che conterrà il JSON caricato
        let datiJSON = [] 

        // Variabile che conterrà il file XML caricato
        let datiXML 


        // FUNZIONE: CARICA JSON

        function caricaDatiJ() {

            console.log("Avvio il caricamento del file JSON...");

            const req = new XMLHttpRequest()
            req.open("GET", "https://magi20015.github.io/LavoriTPS/RegistroPersone.json", true)
            req.send()

            req.onload = function () {
                console.log("Risposta JSON ricevuta:", req.responseText);

                datiJSON = JSON.parse(req.responseText);

                console.log("JSON convertito in oggetto:", datiJSON);

                alert("JSON caricato correttamente!");
            }
        }


        // FUNZIONE: CARICA XML
        function caricaDatiX(){

            console.log("Avvio il caricamento del file XML...");

            const req = new XMLHttpRequest(); 

            req.onreadystatechange = function() {

                console.log("Stato richiesta XML:", this.readyState);

                if (this.readyState == 4 && this.status == 200) {
                    console.log("XML ricevuto correttamente:", this.responseXML); //CONTROLLO CHE LA FUNZIONE SIA STATA CARICATA CORRETTAMENTE (PRESO FILE PROF)

                    datiXML = this.responseXML;

                    console.log("!caricatoo!");
                }
            };

            req.open("GET", "https://magi20015.github.io/LavoriTPS/RegistroPersone.xml", true);
            req.send();
        }


        
        // FUNZIONE: MOSTRA DATI XML IN TABELLA
        
        function letturaX() {

            console.log("Inizio lettura del file XML...");

            let listaPersoneXML = datiXML.documentElement.children;
            console.log(listaPersoneXML);

            let campiXML = listaPersoneXML[0].children;

            let tabellaFinale = document.createElement("table");

            // CREA INTESTAZIONI
            let rigaIntestazione = document.createElement("tr");
            for (let i = 0; i < campiXML.length; i++) {
                let th = document.createElement("th");
                th.textContent = campiXML[i].tagName;
                rigaIntestazione.appendChild(th);
            }
            tabellaFinale.appendChild(rigaIntestazione);

            // CREA RIGHE CON DATI
            for (let i = 0; i < listaPersoneXML.length; i++) {

                let rigaXML = document.createElement("tr");
                let campiPersonaXML = listaPersoneXML[i].children;

                console.log(campiPersonaXML);

                for (let j = 0; j < campiPersonaXML.length; j++) {
                    let td = document.createElement("td");
                    td.textContent = campiPersonaXML[j].textContent;
                    rigaXML.appendChild(td);
                }

                tabellaFinale.appendChild(rigaXML);
            }

            document.getElementById("outputXml").appendChild(tabellaFinale);
        }


        // FUNZIONE: MOSTRA JSON IN TABELLA
        function lettura() {


            let tabellaFinale = document.createElement("table");
            const chiavi = Object.keys(datiJSON[0]);
            console.log(chiavi);
            // CREA INTESTAZIONI TABELLLA
            let rigaIntestazione = document.createElement("tr");
            for (let i = 0; i < chiavi.length; i++) {
                let th = document.createElement("th");
                th.textContent = chiavi[i];
                rigaIntestazione.appendChild(th);
            }
            tabellaFinale.appendChild(rigaIntestazione);

            // CREA RIGHE
            for (let i = 0; i < datiJSON.length; i++) {
                let rigaJSON = document.createElement("tr");

                console.log("Lettura persona JSON numero", i, datiJSON[i]);

                for (let j = 0; j < chiavi.length; j++) {
                    let cellaJSON = document.createElement("td");
                    cellaJSON.textContent = datiJSON[i][chiavi[j]];
                    rigaJSON.appendChild(cellaJSON);
                }

                tabellaFinale.appendChild(rigaJSON);
            }

            document.getElementById("output").appendChild(tabellaFinale);
        }


        // FUNZIONE: MOSTRA SOLO I MAGGIORENNI
        function maggiorenni(){

            console.log("Cerco i maggiorenni nel JSON...");

            let listaMaggiorenni = "";

            for (let i=0; i<datiJSON.length; i++){
                if (datiJSON[i]["età"] > 18){

                    console.log( datiJSON[i]);

                    listaMaggiorenni += datiJSON[i]["cognome"] + " " + datiJSON[i]["età"] + "<br>";
                }
            }

            document.getElementById("outputMa").innerHTML = listaMaggiorenni;
        }


        // FUNZIONE: RICERCA COGNOMI PER LETTERA
        function ricerca(){

            let lettera = document.getElementById("ricerca").value;

            console.log("Ricerca cognomi che iniziano per:", lettera);

            let cognomiFiltrati = "I cognomi che iniziano con " + lettera + " sono: <br>";

            for (let i = 0; i < datiJSON.length; i++) {

                let cognomeAttuale = datiJSON[i]["cognome"];

                if (cognomeAttuale.startsWith(lettera)) {

                    console.log("Cognome trovato:", cognomeAttuale);

                    cognomiFiltrati += cognomeAttuale + "<br>";
                }
            }

            document.getElementById("outputCg").innerHTML = cognomiFiltrati;
        }


        // FUNZIONE: CALCOLA LA GENERAZIONE
        function generazione(){

            let annoNascita = document.getElementById("eta").value;

            console.log("Anno inserito:", annoNascita);

            let testoGenerazione = "";

            if (annoNascita >= 1901 && annoNascita <= 1927)
                testoGenerazione = "Appartieni alla Greatest Generation (1901-1927)";
            else if (annoNascita >= 1928 && annoNascita <= 1945)
                testoGenerazione = "Appartieni alla Generazione Silenziosa (1928-1945)";
            else if (annoNascita >= 1946 && annoNascita <= 1964)
                testoGenerazione = "Appartieni ai Baby Boomers (1946-1964)";
            else if (annoNascita >= 1965 && annoNascita <= 1980)
                testoGenerazione = "Appartieni alla Generazione X (1965-1980)";
            else if (annoNascita >= 1981 && annoNascita <= 1996)
                testoGenerazione = "Appartieni ai Millenials (1981-1996)";
            else if (annoNascita >= 1997 && annoNascita <= 2012)
                testoGenerazione = "Appartieni alla Generazione Z (1997-2012)";
            else if (annoNascita >= 2013)
                testoGenerazione = "Appartieni alla Generazione Alpha (dal 2013 in poi)";
            else
                testoGenerazione = "Anno di nascita non valido";

            console.log("Generazione calcolata:", testoGenerazione);

            document.getElementById("outputGe").innerHTML = testoGenerazione;
        }

    </script>
</head>

